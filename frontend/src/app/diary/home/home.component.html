<div class="container mx-auto px-4 py-10">
  <!-- Loading Indicator -->
  <div *ngIf="isLoading" class="fixed inset-0 flex items-center justify-center bg-black bg-opacity-30 z-50">
    <div class="bg-white p-6 rounded-lg shadow-lg">
      <p class="text-lg font-semibold">Loading...</p>
    </div>
  </div>

  <!-- Error Message -->
  <div *ngIf="errorMessage" class="mb-4 p-4 bg-red-100 border border-red-400 text-red-700 rounded">
    {{ errorMessage }}
    <button (click)="errorMessage = ''" class="float-right font-bold">&times;</button>
  </div>

  <!-- Hero Section -->
  <div class="text-center mb-8">
    <h1 class="text-3xl sm:text-4xl font-semibold text-gray-800">Welcome to Your Private Diary</h1>
    <p class="mt-2 text-lg text-gray-600">Keep track of your thoughts and emotions in a private, secure space.</p>
  </div>

  <!-- Create Entry Button -->
  <div class="text-center mb-6">
    <button
      (click)="openModal()"
      class="px-6 py-3 bg-indigo-600 text-white font-semibold rounded-lg shadow-lg hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-opacity-50 transition"
    >
      Create New Entry
    </button>
  </div>

  <!-- Filter Section -->
  <div class="mb-6 flex justify-center items-center">
    <input
      [(ngModel)]="filter"
      type="text"
      placeholder="Search by tag..."
      class="w-64 px-4 py-2 border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-opacity-50"
    />
    <button
      (click)="applyFilter()"
      class="ml-4 px-6 py-2 bg-indigo-600 text-white font-semibold rounded-lg shadow-lg hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-opacity-50 transition"
    >
      Apply Filter
    </button>
  </div>
  <p *ngIf="filter" class="text-gray-500 text-sm mt-2">Filtering by tags: {{ filter }}</p>
  <!-- Diary Entries -->
  <div *ngIf="entries.length; else noEntries" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6">
    <div *ngFor="let entry of entries" class="bg-white rounded-lg shadow-md hover:shadow-lg transition-all">
      <div class="p-6">
        <h2 class="text-xl font-semibold text-gray-800">{{ entry.title }}</h2>
        <p class="mt-2 text-gray-600">{{ entry.content | slice:0:100 }}{{ entry.content.length > 100 ? '...' : '' }}</p>
        
        <!-- Tags Display -->
        <div class="mt-2 text-gray-500">
          <span *ngFor="let tag of getTags(entry)" class="bg-gray-200 px-2 py-1 rounded-full text-sm mr-2 mb-1 inline-block">
            {{ tag }}
          </span>
        </div>
        
        <!-- Mood Display -->
        <div class="mt-2 text-xl">
          <span [ngSwitch]="entry.mood">
            <span *ngSwitchCase="'happy'">ðŸ˜Š</span>
            <span *ngSwitchCase="'sad'">ðŸ˜”</span>
            <span *ngSwitchCase="'angry'">ðŸ˜¡</span>
            <span *ngSwitchCase="'excited'">ðŸ˜ƒ</span>
            <span *ngSwitchDefault>{{ entry.mood || 'No mood set' }}</span>
          </span>
        </div>
        
        <div class="mt-4 flex justify-between items-center">
          <button
            (click)="openEditModal(entry)"
            class="px-4 py-1 bg-blue-100 text-blue-600 rounded hover:bg-blue-200 transition"
          >
            Edit
          </button>
          <button
  (click)="openViewModal(entry)"
  class="px-4 py-1 bg-green-100 text-green-600 rounded hover:bg-green-200 transition"
>
  View
</button>
          <button
            (click)="deleteEntry(entry._id)"
            class="px-4 py-1 bg-red-100 text-red-600 rounded hover:bg-red-200 transition"
          >
            Delete
          </button>
        </div>
      </div>
    </div>
  </div>

  <ng-template #noEntries>
    <div class="text-center py-10">
      <p class="text-gray-500">No entries found. Create your first entry!</p>
    </div>
  </ng-template>
<!-- View Entry Modal -->
<div *ngIf="viewEntry" class="fixed inset-0 flex items-center justify-center bg-gray-500 bg-opacity-75 z-50">
  <div class="bg-white p-6 rounded-lg shadow-lg max-w-lg w-full mx-4">
    <h2 class="text-2xl font-bold mb-4">{{ viewEntry.title }}</h2>
    <p class="mb-4 text-gray-700 whitespace-pre-wrap">{{ viewEntry.content }}</p>
    
    <div class="mb-2">
      <strong>Tags:</strong>
      <span *ngFor="let tag of getTags(viewEntry)" class="inline-block bg-gray-200 px-2 py-1 rounded-full text-sm mr-2">
        {{ tag }}
      </span>
    </div>
    
    <div class="mb-4">
      <strong>Mood:</strong>
      <span [ngSwitch]="viewEntry.mood">
        <span *ngSwitchCase="'happy'">ðŸ˜Š</span>
        <span *ngSwitchCase="'sad'">ðŸ˜”</span>
        <span *ngSwitchCase="'angry'">ðŸ˜¡</span>
        <span *ngSwitchCase="'excited'">ðŸ˜ƒ</span>
        <span *ngSwitchDefault>{{ viewEntry.mood || 'No mood set' }}</span>
      </span>
    </div>

    <button (click)="closeViewModal()" class="px-6 py-2 bg-gray-500 text-white rounded-lg hover:bg-gray-600">
      Close
    </button>
  </div>
</div>

  <!-- Modal for Create/Edit Entry -->
  <div *ngIf="showModal" class="fixed inset-0 flex items-center justify-center bg-gray-500 bg-opacity-75 z-50">
    <div class="bg-white p-8 rounded-lg shadow-lg max-w-lg w-full mx-4">
      <h3 class="text-xl font-semibold mb-4">{{ editMode ? 'Edit Entry' : 'Create New Entry' }}</h3>
      
      <form (ngSubmit)="submitEntry()" #entryForm="ngForm">
        <div class="mb-4">
          <label class="block text-gray-700 mb-2">Title *</label>
          <input
            [(ngModel)]="newEntry.title"
            name="title"
            type="text"
            class="w-full px-4 py-2 border border-gray-300 rounded-lg"
            required
          />
        </div>
        
        <div class="mb-4">
          <label class="block text-gray-700 mb-2">Content *</label>
          <textarea
            [(ngModel)]="newEntry.content"
            name="content"
            class="w-full px-4 py-2 border border-gray-300 rounded-lg"
            rows="4"
            required
          ></textarea>

        </div>
        <button
  (click)="analyzeContent()"
  class="mt-2 px-4 py-2 bg-purple-600 text-white font-medium rounded hover:bg-purple-700 transition"
>
  Auto Generate Title & Mood
</button>
        <!-- Tags Section -->
        <div class="mb-4">
          <label class="block text-gray-700 mb-2">Tags</label>
          <div *ngFor="let tag of newEntry.tags; let i = index; trackBy: trackByIndex">
            <input
              [(ngModel)]="newEntry.tags[i]"
              [name]="'tag' + i"
              type="text"
              class="flex-1 px-4 py-2 border border-gray-300 rounded-lg mr-2"
              placeholder="Tag"
            />
            <button
              *ngIf="newEntry.tags.length > 1"
              (click)="removeTag(i)"
              type="button"
              class="px-3 py-1 bg-red-100 text-red-600 rounded hover:bg-red-200"
            >
              Remove
            </button>
          </div>
          <button
            (click)="addTag()"
            type="button"
            class="px-4 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300"
          >
            + Add Tag
          </button>
        </div>

        <div class="mb-6">
          <label class="block text-gray-700 mb-2">Mood</label>
          <select 
            [(ngModel)]="newEntry.mood" 
            name="mood" 
            class="w-full px-4 py-2 border border-gray-300 rounded-lg"
          >
            <option value="happy">Happy</option>
            <option value="sad">Sad</option>
            <option value="angry">Angry</option>
            <option value="excited">Excited</option>
          </select>
        </div>

        <div class="flex justify-between">
          <button 
            type="submit" 
            class="px-6 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 disabled:opacity-50"
            [disabled]="entryForm.invalid || isLoading"
          >
            {{ isLoading ? 'Processing...' : (editMode ? 'Update Entry' : 'Create Entry') }}
          </button>
          <button 
            (click)="closeModal()" 
            type="button" 
            class="px-6 py-2 bg-gray-500 text-white rounded-lg hover:bg-gray-600"
          >
            Cancel
          </button>
        </div>
      </form>
    </div>
  </div>
</div>