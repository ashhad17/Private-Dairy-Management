<div class="container">
  <!-- Loading Indicator -->
  <div *ngIf="isLoading" class="loading-backdrop">
    <div class="loading-container">
      <div class="loading-spinner"></div>
      <span class="loading-text">Loading...</span>
    </div>
  </div>

  <!-- Error Message -->
  <div *ngIf="errorMessage" class="error-message">
    {{ errorMessage }}
    <button (click)="errorMessage = ''" class="error-close cursor-pointer">&times;</button>
  </div>

  <!-- Hero Section -->
  <div class="hero">
    <h1>Your Private Diary</h1>
    <p>Keep track of your thoughts and emotions in a private, secure space.</p>
  </div>

  <!-- Create Entry Button -->
  <div style="text-align: center;">
    <button (click)="openModal()" class="create-btn cursor-pointer">
      Create New Entry
    </button>
  </div>

  <!-- Filter Section -->
  <div class="filter-container">
    <input [(ngModel)]="filter" type="text" placeholder="Search by mood..." class="filter-input" />
    <button (click)="applyFilter()" class="filter-btn cursor-pointer">
      Apply Filter
    </button>
  </div>

  <p *ngIf="filter" style="text-align: center; color: #64748b; font-size: 0.875rem; margin-bottom: 1.5rem;">
    Filtering by mood: {{ filter }}
  </p>

  <!-- Diary Entries -->
  <div *ngIf="entries.length; else noEntries" class="entries-grid">
    <div *ngFor="let entry of entries; let i = index" class="entry-card" [style.animation-delay]="i * 0.1 + 's'">
      <div class="card-content">
        <h2 class="card-title">{{ entry.title }}</h2>
        <p class="card-text">{{ entry.content | slice:0:100 }}{{ entry.content.length > 100 ? '...' : '' }}</p>

        <!-- Tags Display -->
        <div class="card-tags">
          <span *ngFor="let tag of getTags(entry)" class="tag">
            {{ tag }}
          </span>
        </div>

        <!-- Mood Display -->
        <div class="card-mood">
          <span [ngSwitch]="entry.mood">
            <span *ngSwitchCase="'happy'">ðŸ˜Š</span>
            <span *ngSwitchCase="'sad'">ðŸ˜”</span>
            <span *ngSwitchCase="'angry'">ðŸ˜¡</span>
            <span *ngSwitchCase="'excited'">ðŸ˜ƒ</span>
            <span *ngSwitchDefault>{{ entry.mood || 'No mood set' }}</span>
          </span>
        </div>

        <div class="card-actions">
          <button (click)="openEditModal(entry)" class="btn btn-edit cursor-pointer">
            Edit
          </button>
          <button (click)="openViewModal(entry)" class="btn btn-view cursor-pointer">
            View
          </button>
          <button (click)="deleteEntry(entry._id)" class="btn btn-delete cursor-pointer">
            Delete
          </button>
        </div>
      </div>
    </div>
  </div>

  <ng-template #noEntries>
    <div class="empty-state">
      <p>No entries found. Create your first entry!</p>
    </div>
  </ng-template>

  <!-- View Entry Modal -->
  <div *ngIf="viewEntry" class="modal-backdrop">
    <div class="modal">
      <h2 class="modal-title">{{ viewEntry.title }}</h2>
      <p style="margin-bottom: 1.5rem; white-space: pre-wrap; line-height: 1.6;">{{ viewEntry.content }}</p>

      <div style="margin-bottom: 1rem;">
        <strong>Tags:</strong>
        <div class="card-tags" style="margin-top: 0.5rem;">
          <span *ngFor="let tag of getTags(viewEntry)" class="tag">
            {{ tag }}
          </span>
        </div>
      </div>

      <div style="margin-bottom: 1.5rem;">
        <strong>Mood:</strong>
        <span [ngSwitch]="viewEntry.mood" style="margin-left: 0.5rem; font-size: 1.5rem;">
          <span *ngSwitchCase="'happy'">ðŸ˜Š</span>
          <span *ngSwitchCase="'sad'">ðŸ˜”</span>
          <span *ngSwitchCase="'angry'">ðŸ˜¡</span>
          <span *ngSwitchCase="'excited'">ðŸ˜ƒ</span>
          <span *ngSwitchDefault>{{ viewEntry.mood || 'No mood set' }}</span>
        </span>
      </div>

      <button (click)="closeViewModal()" class="btn-cancel cursor-pointer">
        Close
      </button>
    </div>
  </div>

  <!-- Modal for Create/Edit Entry -->
  <div *ngIf="showModal" class="modal-backdrop">
    <div class="modal">
      <h3 class="modal-title">{{ editMode ? 'Edit Entry' : 'Create New Entry' }}</h3>

      <form (ngSubmit)="submitEntry()" #entryForm="ngForm">
        <div class="form-group">
          <label class="form-label">Title *</label>
          <input [(ngModel)]="newEntry.title" name="title" type="text" class="form-control" required />
        </div>

        <div class="form-group">
          <label class="form-label">Content *</label>
          <textarea [(ngModel)]="newEntry.content" name="content" class="form-control" rows="4" required></textarea>
        </div>

        <button type="button" (click)="analyzeContent()" class="btn-analyze cursor-pointer">
          Auto Generate Title & Mood
        </button>

        <!-- Tags Section -->
        <div class="form-group">
          <label class="form-label">Tags</label>
          <div *ngFor="let tag of newEntry.tags; let i = index; trackBy: trackByIndex" class="tag-group">
            <input
              [(ngModel)]="newEntry.tags[i]"
              [name]="'tag' + i"
              type="text"
              class="form-control"
              placeholder="Tag"
            />
            <button
              *ngIf="newEntry.tags.length > 1"
              (click)="removeTag(i)"
              type="button"
              class="btn-remove-tag cursor-pointer"
            >
              Remove
            </button>
          </div>
          <button (click)="addTag()" type="button" class="btn-add-tag cursor-pointer">
            Add Tag
          </button>
        </div>

        <div class="form-group">
          <label class="form-label">Mood</label>
          <select [(ngModel)]="newEntry.mood" name="mood" class="form-control">
            <option value="happy">Happy</option>
            <option value="sad">Sad</option>
            <option value="angry">Angry</option>
            <option value="excited">Excited</option>
          </select>
        </div>

        <div class="modal-actions">
          <button
            type="submit"
            class="btn-submit cursor-pointer"
            [disabled]="entryForm.invalid || isLoading"
          >
            {{ isLoading ? 'Processing...' : (editMode ? 'Update Entry' : 'Create Entry') }}
          </button>
          <button (click)="closeModal()" type="button" class="btn-cancel cursor-pointer">
            Cancel
          </button>
        </div>
      </form>
    </div>
  </div>
</div>
